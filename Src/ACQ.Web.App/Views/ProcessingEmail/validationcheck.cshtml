@model IEnumerable<ACQ.Web.App.ViewModel.EscalationReportData>

@{
    ViewBag.Title = "validationcheck";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/assets/datatable/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/assets/datatable/css/buttons.dataTables.min.css" rel="stylesheet" />
<style>
    table.dataTable tbody th, table.dataTable tbody td {
        padding: 10px 18px !important;
    }

    .red {
        color: red;
    }

    .green {
        color: forestgreen;
    }
    .cards {
        position: relative;
        display: block;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #f9f9f9;
        background-clip: border-box;
        border: 1px solid rgb(226 222 222 / 13%);
        border-radius: .25rem;
        font-size: 12px;
    }
</style>

<div class="containers">
    <div class="container-fluids">
        <div class="card">
            <div class="card-header">
                <h4>Processing  </h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="display nowrap" style="width:100%">
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="checkbox" id="selectall" onchange="selectAll();" /></th>
                                <th>AON Id</th>
                                <th>Service Lead Service</th>
                                <th>Item Description</th>
                                <th>Date of Accord AON</th>
                                <th style="width:300px !important;">Draft Message</th>
                                <th>Date Of Alert</th>
                                <th>Email Receivers</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.Count() > 0)
                            {
                                foreach (var item in Model.ToList())
                                {
                                    <tr>
                                        <td>
                                            <input type="checkbox" class="checkbox checkbox-select" noaon="@item.aon_id" notls="@item.MSG_TYPE" onchange="getselect();" />
                                        </td>
                                        <td>
                                            @item.aon_id
                                        </td>
                                        <td>@item.Service_Lead_Service</td>
                                        <td>
                                            
                                            @item.item_description
                                            
                                        </td>
                                        <td>
                                            @item.dateofaccordAON
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(item.msg))
                                            {
                                                <p>@item.msg</p>
                                            }
                                            else
                                            {
                                                <p>No draft available</p>
                                            }
                                    </td>
                                    <td>
                                        @if (item.date_of_alert != null)
                                        {
                                            <span>@item.date_of_alert.Value.ToString("MM/dd/yyyy")</span>
                                        }
                                    </td>
                                    <td>
                                        @if (string.IsNullOrEmpty(item.L1_Officer_Email)==false && item.L1_Officer_Email!= "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L1_Officer_Name Phone: @if (!string.IsNullOrEmpty(item.L1_Officer_Phone))
                                                {<span>@item.L1_Officer_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L1_Officer_Email))
                                                {<span>@item.L1_Officer_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }




                                        @if (string.IsNullOrEmpty(item.L2_Officer_Email) == false && item.L2_Officer_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L2_Officer_Name Phone: @if (!string.IsNullOrEmpty(item.L2_Officer_Phone))
                                                {<span>@item.L2_Officer_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L2_Officer_Email))
                                                {<span>@item.L2_Officer_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }

                                        @if (string.IsNullOrEmpty(item.L3_Officer_Email) == false && item.L3_Officer_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L3_Officer_Name Phone: @if (!string.IsNullOrEmpty(item.L3_Officer_Phone))
                                                {<span>@item.L3_Officer_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L3_Officer_Email))
                                                {<span>@item.L3_Officer_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }

                                        @if (string.IsNullOrEmpty(item.L4_Officer_Email) == false && item.L4_Officer_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L4_Officer_Name Phone: @if (!string.IsNullOrEmpty(item.L4_Officer_Phone))
                                                {<span>@item.L4_Officer_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L4_Officer_Email))
                                                {<span>@item.L4_Officer_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }

                                        @if (string.IsNullOrWhiteSpace(item.L5_ADGAcq_Email) == false && item.L5_ADGAcq_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L5_ADGAcq_Name Phone: @if (!string.IsNullOrEmpty(item.L5_ADGAcq_Phone))
                                                {<span>@item.L5_ADGAcq_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L5_ADGAcq_Email))
                                                {<span>@item.L5_ADGAcq_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }

                                        @if (string.IsNullOrWhiteSpace(item.L6_JS_AM_Email) == false && item.L6_JS_AM_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L6_JS_AM_Name Phone: @if (!string.IsNullOrEmpty(item.L6_JS_AM_Phone))
                                                {<span>@item.L6_JS_AM_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L6_JS_AM_Email))
                                                {<span>@item.L6_JS_AM_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }

                                        @if (string.IsNullOrWhiteSpace(item.L7_FM_Email) == false && item.L7_FM_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L7_FM_Name Phone: @if (!string.IsNullOrEmpty(item.L7_FM_Phone))
                                                {<span>@item.L7_FM_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L7_FM_Email))
                                                {<span>@item.L7_FM_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }

                                        @if (string.IsNullOrWhiteSpace(item.L8_DG_Acq_Email) == false && item.L8_DG_Acq_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L8_DG_Acq_Name Phone: @if (!string.IsNullOrEmpty(item.L8_DG_Acq_Phone))
                                                {<span>@item.L8_DG_Acq_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L8_DG_Acq_Email))
                                                {<span>@item.L8_DG_Acq_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }

                                        @if (string.IsNullOrWhiteSpace(item.L9_AS_FA_Email) == false && item.L9_AS_FA_Email != "N/A")
                                        {
                                            <div class="cards">
                                                Name : @item.L9_AS_FA_Name Phone: @if (!string.IsNullOrEmpty(item.L9_AS_FA_Phone))
                                                {<span>@item.L9_AS_FA_Phone</span>}
                                            else
                                            {<span>N/A</span>}
                                                Email: @if (!string.IsNullOrEmpty(item.L9_AS_FA_Email))
                                                {<span>@item.L9_AS_FA_Email</span>}
                                            else
                                            { <span>N/A</span>}
                                            </div>
                                        }




                                    </td>


                                    <td><button type="button" class="btn btn-sm btn-primary Edit"><i class="fa fa-edit"></i> </button> </td>
                                </tr>
                            }
                        }
                        </tbody>
                        <tfoot>
                            <tr>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th><button class="btn btn-sm btn-primary" type="button" id="SendtoAll">Send Email</button></th>

                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>


    </div>
</div>

<script src="~/assets/js/jquery-3.6.0.min.js" nonce="r@nd0m"></script>
<script src="~/assets/datatable/js/jquery.dataTables.min.js" nonce="r@nd0m"></script>
<script src="~/assets/datatable/js/dataTables.buttons.min.js" nonce="r@nd0m"></script>
<script src="~/assets/datatable/js/jszip.min.js" nonce="r@nd0m"></script>
@*<script src="~/assets/datatable/js/pdfmake.min.js"></script>*@
<script src="~/assets/datatable/js/vfs_fonts.js" nonce="r@nd0m"></script>
<script src="~/assets/datatable/js/buttons.html5.min.js" nonce="r@nd0m"></script>
<script src="~/assets/datatable/js/buttons.print.min.js" nonce="r@nd0m"></script>
<script nonce="r@nd0m">
    jQuery(document).ready(function ($) {
        //$('#example').DataTable({
        //    dom: 'Bfrtip',
        //    buttons: [
        //        'copy', 'csv', 'excel', 'pdf', 'print'
        //    ]
        //});

        $('#example').DataTable({
            dom: 'Bfrtip',
            buttons: [
                {
                    extend: 'excel',
                    text: 'Download'
                },
                {
                    extend: 'print',
                    text: 'Print'
                }
            ],
            pageLength: 25
        });

        getselect();

        $(document).on('click', '#SendtoAll', function () {

            var btn = $(this);
            var data = [];
            $('tbody tr').each(function () {
                if ($(this).children().find('.checkbox-select').is(':checked')) {
                    var EscalationReportData = {};
                    EscalationReportData["aon_id"] = parseInt($(this).children().find('.checkbox-select').attr("noaon")),
                        EscalationReportData["CaseTaskSlno"] = $(this).children().find('.checkbox-select').attr("notls");
                    EscalationReportData["EscalationTime"] = Math.abs(parseInt($(this).children().find('.checkbox-select').attr("notes")));
                    EscalationReportData["dap_timeline"] = $(this).children().find('.checkbox-select').attr("notdp");
                    data.push(EscalationReportData);
                }
            });

            $(btn).attr('disabled', true);

            $.ajax({
                beforeSend: function () {
                    $('.preloader').show();
                },
                type: "POST",
                url: "/sendEscalationEmail",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    $('.preloader').fadeOut('slow');
                    if (response.Status == true) {
                        alert("Email has been send to the selected user");
                        window.location.href = "/validationchecker";
                    } else {
                        alert("Something went wrong");
                    }
                },
                failure: function (response) {
                    deselectAll();
                    alert("Please check your internet connection...");
                },
                error: function (response) {
                    deselectAll();
                    alert("Please check your internet connection...");
                }
            });
        });
    });
    function getselect() {
        var selected = 0;
        $('tbody tr').each(function () {
            if ($(this).children().find('.checkbox-select').is(':checked')) {
                selected += 1;
            }
        });

        if (selected > 0) {
            $('#SendtoAll').attr('disabled', false);
        }
        else {
            $('#SendtoAll').attr('disabled', true);
        }
    }
    function selectAll() {
        if ($('#selectall').is(":checked")) {
            $('tbody tr').each(function () {
                $(this).children().find('.checkbox-select').attr('checked', true);
                $(this).children().find('.checkbox-select').attr('disabled', true);
            });
            getselect();
        }
        else {
            $('tbody tr').each(function () {
                $(this).children().find('.checkbox-select').attr('checked', false);
                $(this).children().find('.checkbox-select').attr('disabled', false);
            });
            getselect();
        }
    }
</script>


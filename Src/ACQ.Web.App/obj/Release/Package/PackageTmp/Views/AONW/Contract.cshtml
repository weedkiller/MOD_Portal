@{
    ViewBag.Title = "Contract";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/assets/css/jquery-ui.css" rel="stylesheet" />
<style>
    .ui-datepicker {
        width: 18.8em !important;
    }
    .btn-area {
        position: absolute;
        bottom: 18px;
    }
    .btn-delete {
        position: absolute;
        bottom: 18px;
        LEFT: 14%;
    }
</style>
<div class="mt-3 container-fluid">
    @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" }))
    {
        @Html.AntiForgeryToken()

        <div class="tabHead mb-1">
            <div class="row">
                <div class="col-md-6"><h3>Enter Contract Details</h3></div>

            </div>
        </div>

        <div class="_sb">

            <div class="card flex-fill w-100 p-3">

                <div class="form-group row">


                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">Services<span style="color:red;">*</span> <span id="vldServices" style="color:red;display:none">Please enter Services</span></label>
                        <div class="form-group m-0">
                            <select class="form-select form-control Services" name="Services" id="Services">
                                <option value="Army">Army</option>
                                <option value="Navy">Navy</option>
                                <option value="AirForce">AirForce</option>
                            </select>

                        </div>
                    </div>

                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">Contract Id <span style="color:red;">*</span> <span id="vldContractId" style="color:red;display:none">Please enter Contract Id</span></label>
                        <div class="form-group m-0">
                            <input type="text" name="ContractId" id="ContractId" placeholder="Contract Id" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">Contract Number<span style="color:red;">*</span><span id="vldContract_Number" style="color:red;display:none">Please enter Contract Number</span></label>
                        <div class="form-group m-0">
                            <input type="text" name="Contract_Number" id="Contract_Number" placeholder="Contract Number" class="form-control" />

                        </div>
                    </div>
                </div>


                <div class="form-group row">

                    <div class="col-md-12 col-sm-12 col-lg-12">
                        <label for=" " class="col-form-label">Description<span style="color:red;">*</span><span id="vldDescriptions" style="color:red;display:none">Please enter Description</span></label>
                        <div class="form-group m-0">

                            <textarea rows="3" name="Description" id="Descriptions" placeholder="Description" class="form-control"> </textarea>

                        </div>
                    </div>
                </div>
                <div class="form-group row">

                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">Category<span style="color:red;">*</span><span id="vldCategory" style="color:red;display:none">Please enter Category</span></label>
                        <div class="form-group m-0">
                            <input type="text" name="Category" id="Category" placeholder="Category" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <div class="form-group m-0">
                            <label for=" " class="col-form-label">Date Of Contract Signing <span style="color:red;">*</span><span id="vldDateOfContractSigning" style="color:red;display:none">Please enter Date Of Contract Signing</span></label>
                            <input type="text" name="DateOfContractSigning" id="DateOfContractSigning" placeholder="Date Of Contract Signing" class="datepicker form-control" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">Effective Date/TO Date</label>
                        <div class="form-group m-0">
                            <input type="text" name="EffectiveDate" id="EffectiveDate" placeholder="Effective Date/TO Date" class="form-control datepicker" />

                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">ABG Date/LC Opening Date</label>
                        <div class="form-group m-0">
                            <input type="text" name="ABGDate" id="ABGDate" placeholder="ABG Date/LC Opening Date" class="form-control datepicker" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">PWBG %</label>
                        <div class="form-group m-0">
                            <input type="text" name="PWBG" id="PWBGPercentage" placeholder="PWBG %" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class=" col-form-label">PWBG Date</label>
                        <div class="form-group m-0">
                            <input type="text" name="PWBGDate" id="PWBGDate" placeholder="PWBG Date" class="form-control datepicker" />

                        </div>
                    </div>

                </div>


                <div class="form-group row">


                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class="col-form-label">Incoterms</label>
                        <div class="form-group m-0">
                            <input type="text" name="Incoterms" id="Incoterms" placeholder="Incoterms " class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class=" col-form-label">Warranty</label>
                        <div class="form-group m-0">
                            <input type="text" name="Warranty" id="Warranty" placeholder="Warranty " class="form-control" />

                        </div>
                    </div>

                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label for=" " class=" col-form-label">Contract Value<span style="color:red;">*</span><span id="vldContractValue" style="color:red;display:none">Please enter ContractValue</span></label>
                        <div class="form-group m-0">
                            <input type="text" name="ContractValue" id="ContractValue" placeholder="Contract Value " class="form-control" />

                        </div>
                    </div>
                </div>


                <div class="form-group row">
                    <div class="col-md-12 col-sm-12 col-lg-12">
                        <label class="col-form-label">FE Content</label>
                        <div class="form-group m-0">
                            <textarea rows="1" name="FEContent" id="FEContent" placeholder="FE Content" class="form-control"></textarea>

                        </div>
                    </div>
                </div>
                <div class="form-group row">


                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label class="col-form-label">Taxes and Duties</label>
                        <div class="form-group m-0">
                            <input type="text" name="TaxesAndDuties" id="TaxesAndDuties" placeholder="Taxes and Duties" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label class="col-form-label">Final Delivery Date<span style="color:red;">*</span><span id="vldFinalDeliveryDate" style="color:red;display:none">Please enter Final Delivery Date</span></label>
                        <div class="form-group m-0">
                            <input type="text" name="FinalDeliveryDate" id="FinalDeliveryDate" placeholder="Final Delivery Date" class="form-control datepicker" />

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4">
                        <label class="col-form-label">Grace Period</label>
                        <div class="form-group m-0">
                            <input type="text" name="GracePeriod" id="GracePeriod" placeholder="Grace Period" class="form-control" />

                        </div>
                    </div>
                </div>


            </div>

        </div>

        <div class="_sbd">

            <div class="card">
                <div class="card-header">
                    <h3>Enter Stage/Milestone Details</h3>
                </div>
                <div class="card-body">
                    <div class="table-body">
                        <div class="Stage">
                            <div class="row">
                                <div class="col-sm-4">

                                    <div class="form-group ">
                                        <label>Stage Number <span style="color:red;">*</span></label>
                                        <input type="text" name="StageNumber" placeholder="Stage Number" class="form-control StageNumber" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Stage Description</label>
                                        <input type="text" name="stageDescription" placeholder="Stage Description" class="form-control StageDescription" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Stage Start Date</label>
                                        <input type="text" name="StageStartdate" placeholder="Stage Start Date" class="form-control StageStartDate datepicker" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Stage Completion Date</label>
                                        <input type="text" name="StageCompletionDate" placeholder="Stage Completion Date" class="form-control StageCompletionDate datepicker" />
                                    </div>
                                </div>
                                <div class="col-sm-4">

                                    <div class="form-group ">
                                        <label>% Of Contract Value<span style="color:red;">*</span></label>
                                        <input type="text" name="PercentOfContractValue" placeholder="% Of Contract Value" class="form-control PercentOfContractValue" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Amount<span style="color:red;">*</span></label>
                                        <input type="text" name="Amount" placeholder="Amount" class="form-control Amount" />
                                    </div>
                                </div>

                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Due Date Of Payment<span style="color:red;">*</span></label>
                                        <input type="text" name="DueDateOfPayment" placeholder="Due Date Of Payment" class="form-control DueDateOfPayment datepicker" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Conditions</label>
                                        <input type="text" name="Conditions" placeholder="Conditions" class="form-control Conditions" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Revised Date Of Payment</label>
                                        <input type="text" name="RevisedDateOfpayment" placeholder="Revised Date Of Payment" class="form-control RevisedDateOfPayment datepicker" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Reason For Slippage</label>
                                        <input type="text" name="ReasonsForSlippage" placeholder="Reason For Slippage" class="form-control ReasonForSlippage" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Actual Date Of Payment<span style="color:red;">*</span></label>
                                        <input type="text" name="ActualDateOfPayment" placeholder="Actual Date Of Payment" class="form-control ActualDateOfPayment datepicker" />
                                    </div>
                                </div>

                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Total Payment Made<span style="color:red;">*</span></label>
                                        <select name="TotalPaymentMade" class="form-select form-control TotalPaymentMade">
                                            <option value="Basic Stage Payment">Basic Stage Payment</option>
                                            <option value="Taxes">Taxes</option>
                                            <option value="Customs Duty">Customs Duty</option>
                                            <option value="ERV Payment">ERV Payment</option>
                                        </select>

                                    </div>
                                </div>

                                <div class="col-sm-4">
                                    <div class="form-group ">
                                        <label>Full or Part Payment Made<span style="color:red;">*</span></label>
                                        <select class="form-select form-control FullorPartPaymentMade" name="FullorPartPaymentMade">
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>

                                        </select>
                                    </div>
                                </div>

                                <div class="col-sm-4">

                                    <button class="btn btn-success btn-sm AddNewStage btn-area" type="button"><i class="fa fa-plus" aria-hidden="true"></i></button>               @*<button id="DeleteStage" class="btn btn-danger DeleteStage"><i class="fa fa-trash" aria-hidden="true"></i></button>*@

                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <button type="button" id="btnSaveDetails" class="btn btn-sm btn-success" value="Save Details" style="float:right;">Save Details</button>

        </div>
    }


</div>


<script src="~/assets/js/jquery-3.6.0.min.js" nonce="r@nd0m"></script>
<script src="~/assets/js/jquery-ui.js"></script>
<script nonce="r@nd0m">
    $(document).ready(function () {
       
            //$(".datepicker").datepicker({
            //    changeMonth: true,
            //    changeYear: true
            //});
       

        $('body').on('focus', ".datepicker", function () {
            $(this).datepicker({
                changeMonth: true,
                changeYear: true
            });
        });

        $(document).on("click", '.AddNewStage', function () {

            $('.table-body').append(' <div class="Stage"><hr/><div class="row"><div class="col-sm-4"><div class="form-group ">                                 <label>Stage Number <span style="color:red;">*</span></label>                                 <input type="text" name="StageNumber" placeholder="Stage Number" class="form-control StageNumber" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Stage Description</label>                                 <input type="text" name="stageDescription" placeholder="Stage Description" class="form-control StageDescription" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Stage Start Date</label>                                 <input type="text" name="StageStartdate" placeholder="Stage Start Date" class="form-control StageStartDate datepicker" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Stage Completion Date</label>                                 <input type="text" name="StageCompletionDate" placeholder="Stage Completion Date" class="form-control StageCompletionDate datepicker" />                             </div>                         </div>                         <div class="col-sm-4">                              <div class="form-group ">                                 <label>% Of Contract Value<span style="color:red;">*</span></label>                                 <input type="text" name="PercentOfContractValue" placeholder="% Of Contract Value" class="form-control PercentOfContractValue" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Amount<span style="color:red;">*</span></label>                                 <input type="text" name="Amount" placeholder="Amount" class="form-control Amount" />                             </div>                         </div>                          <div class="col-sm-4">                             <div class="form-group ">                                 <label>Due Date Of Payment<span style="color:red;">*</span></label>                                 <input type="text" name="DueDateOfPayment" placeholder="Due Date Of Payment" class="form-control DueDateOfPayment datepicker" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Conditions</label>                                 <input type="text" name="Conditions" placeholder="Conditions" class="form-control Conditions" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Revised Date Of Payment</label>                                 <input type="text" name="RevisedDateOfpayment" placeholder="Revised Date Of Payment" class="form-control RevisedDateOfPayment datepicker" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Reason For Slippage</label>                                 <input type="text" name="ReasonsForSlippage" placeholder="Reason For Slippage" class="form-control ReasonForSlippage" />                             </div>                         </div>                         <div class="col-sm-4">                             <div class="form-group ">                                 <label>Actual Date Of Payment<span style="color:red;">*</span></label>                                 <input type="text" name="ActualDateOfPayment" placeholder="Actual Date Of Payment" class="form-control ActualDateOfPayment datepicker" />                             </div>                         </div>                          <div class="col-sm-4">                             <div class="form-group ">                                 <label>Total Payment Made<span style="color:red;">*</span></label>                                 <select name="TotalPaymentMade" class="form-select form-control TotalPaymentMade">                                     <option value="Basic Stage Payment">Basic Stage Payment</option>                                     <option value="Taxes">Taxes</option>                                     <option value="Customs Duty">Customs Duty</option>                                     <option value="ERV Payment">ERV Payment</option>                                 </select>                              </div>                         </div>                          <div class="col-sm-4">                             <div class="form-group ">                                 <label>Full or Part Payment Made<span style="color:red;">*</span></label>                                 <select class="form-select form-control FullorPartPaymentMade" name="FullorPartPaymentMade">                                     <option value="Yes">Yes</option>                                     <option value="No">No</option>                                  </select>                             </div>                         </div>                          <div class="col-sm-4">                             <button type="button"  class="btn btn-sm btn-success AddNewStage btn-area"><i class="fa fa-plus" aria-hidden="true"></i></button>             <button type="button" class="btn btn-sm btn-danger DeleteStage btn-delete"><i class="fa fa-trash" aria-hidden="true"></i></button>                      </div>                      </div>                 </div>');

        });

        $(document).on("click", '.DeleteStage', function () {

            $(this).parent().parent().parent().remove();

        });

        $("#btnSaveDetails").click(function () {

            var form = $('#__AjaxAntiForgeryForm');
            var token = $('input[name="__RequestVerificationToken"]', form).val();

            var btn = $('#btnSaveDetails');
            $(btn).attr("disabled", true);
            var ContractId = $('#ContractId').val();
            var ContractNumber = $('#Contract_Number').val();
            var DateOfContractSigning = $('#DateOfContractSigning').val();
            var Descriptions = $('#Descriptions').val();
            var Category = $('#Category').val();
            var ContractValue = $('#ContractValue').val();
            var FinalDeliveryDate = $('#FinalDeliveryDate').val();


            var Contract = {
                ContractId: $('#ContractId').val(),
                Contract_Number: $('#Contract_Number').val(),
                DateOfContractSigning: $('#DateOfContractSigning').val(),
                Descriptions: $('#Descriptions').val(),
                Category: $('#Category').val(),
                EffectiveDate: $('#EffectiveDate').val(),
                ABGDate: $('#ABGDate').val(),
                PWBGPercentage: $('#PWBGPercentage').val(),
                PWBGDate: $('#PWBGDate').val(),
                Incoterms: $('#Incoterms').val(),
                Warranty: $('#Warranty').val(),
                ContractValue: $('#ContractValue').val(),
                FEContent: $('#FEContent').val(),
                TaxesAndDuties: $('#TaxesAndDuties').val(),
                FinalDeliveryDate: $('#FinalDeliveryDate').val(),
                GracePeriod: $('#GracePeriod').val(),
                Services: $('#Services option:selected').val(),
            };

            var stagesdata = [];
            $('.table-body .Stage').each(function () {
                var stage = {};
                stage["StageNumber"] = parseInt($(this).children().find('.StageNumber').val());
                stage["stageDescription"] = $(this).children().find('.StageDescription').val();
                stage["StageStartdate"] = $(this).children().find('.StageStartDate').val();
                stage["StageCompletionDate"] = $(this).children().find('.StageCompletionDate').val();
                stage["PercentOfContractValue"] = parseInt($(this).children().find('.PercentOfContractValue').val());
                stage["Amount"] = $(this).children().find('.Amount').val();
                stage["DueDateOfPayment"] = $(this).children().find('.DueDateOfPayment').val();
                stage["Conditions"] = $(this).children().find('.Conditions').val();
                stage["RevisedDateOfpayment"] = $(this).children().find('.RevisedDateOfPayment').val();
                stage["ReasonsForSlippage"] = $(this).children().find('.ReasonForSlippage').val();
                stage["ActualDateOfPayment"] = $(this).children().find('.ActualDateOfPayment').val();
                stage["TotalPaymentMade"] = $(this).children().find('.TotalPaymentMade option:selected').val();
                stage["FullorPartPaymentMade"] = $(this).children().find('.FullorPartPaymentMade option:selected').val();

                stagesdata.push(stage);
            });


            var data = {
                "Contrct_Detail": Contract,
                "Stage_Detail": stagesdata
            }


            if (ContractId != "" && ContractNumber != "" && DateOfContractSigning != "" && Descriptions != "" && Category != "" && ContractValue != "" && FinalDeliveryDate != "") {
                $.ajax({
                    beforeSend: function () {
                        $('.preloader').show();
                    },
                    type: "POST",
                    url: "/SaveContract",
                    data: { __RequestVerificationToken: token, cnt: data },
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        $('.preloader').hide();
                        if (response > 0) {
                            alert("form has been saved");
                            window.location.reload();
                        }
                    },
                    failure: function (response) {
                        $('.preloader').hide();
                        $(btn).attr("disabled", false);
                        alert(response.responseText);
                    },
                    error: function (response) {
                        $('.preloader').hide();
                        $(btn).attr("disabled", false);
                        alert(response.responseText);
                    }
                });
            }
            else {
                if (ContractId == "") {
                    //alert("Please enter Contract Id");
                    $('#vldContractId').css({ "display": "block" });
                }
                else if (ContractNumber == "") {
                    $('#vldContract_Number').css({ "display": "block" });
                }
                else if (DateOfContractSigning == "") {
                    $('#vldDateOfContractSigning').css({ "display": "block" });
                }
                else if (Descriptions == "") {
                    $('#vldDescriptions').css({ "display": "block" });
                }
                else if (Category == "") {
                    $('#vldCategory').css({ "display": "block" });
                }
                else if (ContractValue == "") {
                    $('#vldContractValue').css({ "display": "block" });
                }
                else if (FinalDeliveryDate == "") {
                    $('#vldFinalDeliveryDate').css({ "display": "block" });
                }
                else {

                }

            }



        });


    });
</script>

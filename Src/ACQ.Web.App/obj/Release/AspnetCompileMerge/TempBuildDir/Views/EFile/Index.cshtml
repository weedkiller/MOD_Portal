@model ACQ.Web.ViewModel.EFile.Efile.SAVEEfile
@{
    ViewBag.Title = "SOCApproval";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/cdnfile/bootstrap-multiselect.css" rel="stylesheet" />
<link href="~/Content/cdnfile/summernote-bs4.min.css" rel="stylesheet" />
<script src="~/Content/cdnfile/summernote-bs4.min.js"></script>
<script src="~/Content/cdnfile/bootstrap-multiselect.js"></script>
<style>
    /*.selectDrp {
        width: 235px;
        border: 1px solid #d1d1d1 !important;
        background: #fff !important;
        border-radius: 13px !important;
    }

    .note-editor .note-toolbar, .note-popover .popover-content {
        margin: 0;
        padding: 0 0 5px 5px;
        background: #66ffbfb5;
    }

    .note-editor.note-airframe .note-editing-area, .note-editor.note-frame .note-editing-area {
        overflow: hidden;
        background: #66ffbf4a;
    }*/
</style>

<section class="content">
    <div class="mt-3 box-properties mb-5">
        <div class="tabHead mb-3">
            <div class="row">
                <div class="col-md-6"><h4>Note For seeking Approval</h4></div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <a  class="btn btn-primary float-right ViewSOCFilePrev"  <span id="N1Show"><i class="far fa-copy"></i> View SOC preivious </span></a><br>
            </div>
        </div>
        <div id="divViewSOCPrev" style="display:none">
            <table id="RoutingTable" class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th scope="col">S.No</th>
                        <th class="text-center" scope="col">Name</th>
                        <th class="text-center" scope="col">Designation</th>
                        <th class="text-center" scope="col">Subjects</th>
                        <th class="text-center" scope="col">ReferenceNo </th>
                    </tr>
                </thead>
                <tbody id="tblESOCPreviousFiles"></tbody>
            </table>
        </div>
        <div id="MAINDiv" class="mt-3" style="display:none">
            <div class="jumbotron socBox">
                <div class="form-group row">
                    @Html.HiddenFor(model => model.EfileID, new { id = "hidEfileID" })
                </div>
                <div class="form-group row">
                    <label for=" " class="col-sm-3 col-form-label">Subject</label>
                    <div class="col-sm-9">
                        @Html.TextBoxFor(model => model.Subjects, new { id = "txtSubjects", @name = "txtSubjects", @type = "text", @class = "form-control", @placeholder = "Subjects" })

                    </div>
                </div>
                <div class="form-group row">
                    <label for=" " class="col-sm-3 col-form-label">Reference Number</label>
                    <div class="col-sm-9">
                        @Html.TextBoxFor(model => model.ReferenceNo, new { id = "txtReferenceNo", @name = "txtReferenceNo", @type = "text", @class = "form-control", @placeholder = "ReferenceNo" })
                    </div>
                </div>

                <div class="form-group row">
                    <label for=" " class="col-sm-3 col-form-label">SOC</label>
                    <div class="col-sm-6 selectDrp ml-3">
                        @*<input type="button" id="btnSOC" value="Get Selected SOC" />*@
                        <select id="SOCDesription" multiple="multiple" required=required name="SOCDesription" class="form-control selectDrp">
                            @if (ViewBag.SOCDesription != null)
                            {
                                foreach (var item in ViewBag.SOCDesription)
                                {
                                    if (item.Text != null)
                                    {
                                        <option value="@item.Value">
                                            @item.Text
                                        </option>
                                    }
                                }
                            }
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="n1Section" id="divN1ContentType">
            <div class="row m-0">
                <div class="col-md-6"> <span class="n1" id="N1ContentType"></span></div>
            </div>
        </div>

        <div class="mt-3" style="display:none" id="dvUserdetailsN1">
            <div class="container-fluid">
                <div class="row">
                    <div class="float-center mt-2 mb-2 mr-5">
                        <b>Name :</b><span id="N1Name"> </span><br>
                        <b>Designation :</b> <span id="N1Designation"></span><br>
                        <b>Date :</b> <span id="N1EfileDate"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="greenBox col-8 p-0">
                        @*<textarea class="form-control" rows="3" id="txtN1Editor" name="txtN1Editor" rows="2"></textarea>*@
                        <div id="txtN1Editor"></div>
                    </div>
                    <div class="col-md-4">
                        <div>
                            <a class="btn btn-primary " href="#" onclick='N1ShowAttachmentFile();' <span id="N1Show"><i class="far fa-copy"></i> Show Attachment File </span></a><br>
                        </div>
                        <div id="dvAttachmentfileN1" style="display:none">
                            <table id="Attachmenttb" class="table mt-3">
                                <thead>
                                    <tr class="bg-dark">
                                        <th scope="col">S.No</th>
                                        <th class="text-center" scope="col">File Name</th>
                                        <th class="text-center" scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="tblEfileAttcahmentfiles"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="n1Section" id="DivN2ContentType">
            <div class="row m-0">
                <div class="col-md-6" id="divN2ContentType"> <span class="n1" id="N2ContentType"></span></div>
            </div>
        </div>
        <div class="mt-3" style="display:none" id="dvUserdetailsN2">
            <div class="container-fluid">
                <div class="row">
                    <div class="float-center mt-2 mb-2 mr-5">
                        <b>Name :</b><span id="N2Name"> </span><br>
                        <b>Designation :</b> <span id="N2Designation"></span><br>
                        <b>Date :</b> <span id="N2EfileDate"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="   col-8 p-0">
                        @*<textarea class="form-control" rows="3" id="txtN2Editor" name="txtN2Editor" rows="2"></textarea>*@
                        <div id="txtN2Editor"></div>
                    </div>
                    <div class="col-md-4">
                        <div>
                            <a class="btn btn-primary " href="#" onclick='N2ShowAttachmentFile();' <span id="N1Show"><i class="far fa-copy"></i> Show Attachment File </span></a><br>
                        </div>
                        <div id="dvAttachmentfileN2" style="display:none">
                            <table id="Attachmenttb" class="table mt-3">
                                <thead>
                                    <tr class="bg-dark">
                                        <th scope="col">S.No</th>
                                        <th class="text-center" scope="col">File Name</th>
                                        <th class="text-center" scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="tblEfileAttcahmentfilesN2"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="n1Section" id="DivN3ContentType">
            <div class="row m-0">
                <div class="col-md-6" id="DivN3ContentType"> <span class="n1" id="N3ContentType"></span></div>
            </div>
        </div>
        <div class="mt-3">
            <div class="container-fluid">
                <div class="row">
                    @*<div class="greenBox  col-8 p-0">
                            @Html.TextAreaFor(m => m.EditorContent, new { id = "txtEditor", rows = "20", style = "resize:none;width:400px;", placeholder = Html.DisplayNameFor(m => m.EditorContent), @class = "form-control input-lg textarea-editor" })
                            <div class="float-right mt-2 mb-2 mr-5 letterFooter">
                                <span><b>Name :</b> @Session["UserName"].ToString()</span><br>
                                <span><b>Designation :</b> @Session["Designation"].ToString()</span><br>
                                <span><b>Date :</b> @System.DateTime.Now.ToString("dd-MM-yyyy")</span>
                            </div>
                        </div>*@

                    <div class="greenBox  col-8 p-0" id="mainEditor" style="display:none">
                        @*<div id="txtEditor"></div>*@
                        @Html.TextAreaFor(m => m.EditorContent, new { id = "txtEditor", rows = "20", style = "resize:none;width:400px;", placeholder = Html.DisplayNameFor(m => m.EditorContent), @class = "form-control input-lg textarea-editor" })
                        <script>
                            $('#txtEditor').summernote({
                                placeholder: '',
                                tabsize: 2,
                                height: 300
                            });
                        </script>
                        <div class="float-right mt-2 mb-2 mr-5 letterFooter">
                            <span><b>Name :</b> @Session["UserName"].ToString()</span><br>
                            <span><b>Designation :</b> @Session["Designation"].ToString()</span><br>
                            <span><b>Date :</b> @System.DateTime.Now.ToString("dd-MM-yyyy")</span>
                        </div>
                    </div>
                    <div class="col-4 pt-2 pl-3 bgside" id="mainfileupload" style="display:none">
                        <div class="form-group">
                            <div class="d-flex row">
                                <div class="col-md-12 pb-2">
                                    @Html.TextBoxFor(model => model.SOCfile1, new { id = "txtFileName", @name = "txtFileName", @type = "text", @class = "form-control mb-1", @placeholder = "File Name" })
                                    <div class="custom-file">
                                        <input type="file" name="SOC_Files" class="custom-file-input" id="SOC_Files" multiple="multiple" />
                                        <label class="custom-file-label" for="inputGroupFile01">Choose file</label>
                                    </div>
                                    @*<input type="text" name="" value="" class="form-control mb-1" />*@
                                </div>
                                <table class="table m-3" id="FilesList" style="visibility:hidden">

                                    <tr class="bg-dark">
                                        <td>
                                            File Name(s)
                                        </td>
                                        <td>
                                            Action
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <input type="button" id="btnupload" value="Upload" class="btn btn-info float-right" />
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div id="div1" style="display:none">
            <table id="RoutingTable" class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th scope="col">S.No</th>
                        <th class="text-center" scope="col">Name</th>
                        <th class="text-center" scope="col">Sequence </th>
                        <th class="text-center" scope="col">Action</th>
                    </tr>
                </thead>
                <tbody id="tblEfiles"></tbody>
            </table>
        </div>
        <div class="n1Section">
            <div class="row m-0">
                <div class="col-md-12">
                    <div class="float-right">
                        <input class="btn btn-info" type="button" id="btnN1Save" value="Submit File" />
                        <input class="btn btn-info" type="button" id="btnN2Save" value="Submit" style="display:none" />
                        <input class="btn btn-info" type="button" id="btnN3Save" value="Approve" style="display:none" />
                        <button type="button" class="btn btn-danger" style="display:none"><i class="fas fa-times-circle"></i> Disapprove </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
@*@section scripts {*@
<script type="text/javascript">
    function ValidateUploadFile() {
        // debugger;
        var flag = false;
        var array = ['pdf', 'doc', 'docx', 'ppt'];
        var xyz = document.getElementById("SOC_Files");
        var Extension = xyz.value.substring(xyz.value.lastIndexOf('.') + 1).toLowerCase();
        if (array.indexOf(Extension) <= -1) {
            alert("Please Upload only pdf,doc,ppt extension flle");
            flag = false;
            return flag;
        }
        return flag;
    }
</script>
<script type="text/javascript">
    $(function () {
        $('#SOCDesription').multiselect({
            includeSelectAllOption: true,
            selectAllValue: 'multiselect-all',
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            maxHeight: '300',
            buttonWidth: '335',
            optionClass: function (element) {
                var value = $(element).val();
                if (value % 2 == 0) {
                    return 'odd'; // reversed
                }
                else {
                    return 'even'; // reversed
                }
            }
        });
    });
    //$("#btnSOC").click(function () {
    //    var selected = $("#SOCDesription option:selected");
    //    var message = "";
    //    var arrSelected = [];
    //    selected.each(function () {
    //        arrSelected.push($(this).val());
    //        message += $(this).text() + " " + $(this).val() + "\n";
    //    });
    //    alert(message);
    //});
</script>
<script type="text/javascript">
    function ValidateFormForSequence1() {
        var flag = true;
        var selected = $("#SOCDesription option:selected");
        var AonId = "";
        var arrSelected = [];
        selected.each(function () {
            arrSelected.push($(this).val());
            AonId += "," + $(this).val();
        });
        if ($('#txtSubjects').val() == '') {
            alert("Please fill subjects");
            $('#txtSubjects').focus();
            flag = false;
            return flag;
        }
        if ($('#txtReferenceNo').val() == '') {
            alert("Please fill ReferenceNo");
            $('#txtReferenceNo').focus();
            flag = false;
            return flag;
        }
        if (AonId == '') {
            alert("Please select SOC!");
            flag = false;
            return flag;
        }
        return flag;
    }
    function ValidateFormForSequence2() {
        var flag = true;
        if ($('#txtEditor').val() == '') {
            alert("Please fill in Edior");
            $('#txtEditor').focus();
            flag = false;
            return flag;
        }
        return flag;
    }
    $("#btnN1Save").click(function () {
        if (ValidateFormForSequence1()) {
            var selected = $("#SOCDesription option:selected");
            var AonId = "";
            var arrSelected = [];
            selected.each(function () {
                arrSelected.push($(this).val());
                AonId += "," + $(this).val();
            });
            var SubmitData = {
                Subjects: $('#txtSubjects').val(),
                ReferenceNo: $('#txtReferenceNo').val(),
                EfileContentDetails: $('#txtEditor').val(),
                aon_ids: AonId
            };
            // alert(JSON.stringify(SubmitData));
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "/EFile/SubmitEfile",
                data: "{'_model':" + JSON.stringify(SubmitData) + " }",
                dataType: "json",
                traditional: true,
                success: function (result) {
                    if (result != "") {
                        alert(result);
                        EfileDetails();
                        $("#btnN1Save").attr('disabled', 'disabled');
                    }
                    else { $("#btnN1Save").prop('disabled', false); }
                },
                error: function (result) {
                    alert("Error");
                    console.log(result.resText);
                }
            });
        }
    });
    $("#btnN2Save").click(function () {
        if (ValidateFormForSequence2()) {
            // alert('ok');
            var SubmitData = {
                EfileContentDetails: $('#txtEditor').val()
            };
            // alert(JSON.stringify(SubmitData));
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "/EFile/SubmitEfile",
                data: "{'_model':" + JSON.stringify(SubmitData) + " }",
                dataType: "json",
                traditional: true,
                success: function (result) {
                    if (result != "") {
                        alert(result);
                        EfileDetails();
                        $("#btnN2Save").attr('disabled', 'disabled');
                    }
                    else { $("#btnN2Save").prop('disabled', false); }
                },
                error: function (result) {
                    alert("Error");
                    console.log(result.resText);
                }
            });
        }
    });
    $("#btnN3Save").click(function () {
        if (ValidateFormForSequence2()) {
            // alert('ok');
            var SubmitData = {
                EfileContentDetails: $('#txtEditor').val()
            };
            // alert(JSON.stringify(SubmitData));
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "/EFile/SubmitEfile",
                data: "{'_model':" + JSON.stringify(SubmitData) + " }",
                dataType: "json",
                traditional: true,
                success: function (result) {
                    if (result != "") {
                        alert(result);
                        EfileDetails();
                        $("#btnN2Save").attr('disabled', 'disabled');
                    }
                    else { $("#btnN2Save").prop('disabled', false); }
                },
                error: function (result) {
                    alert("Error");
                    console.log(result.resText);
                }
            });
        }
    });
</script>
<script type="text/javascript">
    var formdata = new FormData(); //FormData object
    $(document).ready(function () {
        $('#txtN1Editor').summernote();
        $('#txtEditor').summernote();
        ExistsEfileDetailsByUserID();
        bsCustomFileInput.init()
        $('#btnupload').attr('disabled', 'disabled');
        $('#SOC_Files').attr('disabled', 'disabled');
        $("#txtFileName").on("change", function () {
            $('#SOC_Files').prop('disabled', false);
        });
        $("#txtFileName").keypress(function () {
            $('#SOC_Files').prop('disabled', false);
        });
        $("#txtFileName").keyup(function () {
            $('#SOC_Files').prop('disabled', false);
        });

        $("#SOC_Files").on("change", function () {
            var ValidFileExtension = ['pdf', 'PDF', 'docx', 'DOCX', 'doc', 'DOC', 'PPT', 'ppt'];
            if ($.inArray($(this).val().split('.').pop().toLowerCase(), ValidFileExtension) == -1) {
                alert("Sorry !!! Allowed documents are '.pdf','.doc','.ppt'");
                SOC_Files.value = '';
                return false;
            }
            else {
                var FileName = $('#txtFileName').val();
                if (FileName == '') {
                    alert('Please file File Name');
                    $('#btnupload').attr('disabled', 'disabled');
                    return false;
                }
                var fileInput = document.getElementById('SOC_Files');
                if (fileInput)
                    //Iterating through each files selected in fileInput
                    for (i = 0; i < fileInput.files.length; i++) {
                        var sfilename = fileInput.files[i].name;
                        let srandomid = Math.random().toString(36).substring(7);
                        formdata.append(FileName, fileInput.files[i]);
                        var sFilePath = '/excelfolder/'+ sfilename;
                        var markup = "<tr id='" + srandomid + "'><td>" + FileName + "</td><td><a href='" + sFilePath + "' target='_blank' ><span class='glyphicon glyphicon-remove red'><i class='fas fa-eye text-white'></i></span></a>&nbsp;&nbsp;<a style='display:none' href='#' onclick='DeleteFile(\"" + srandomid + "\",\"" + FileName +
                            "\")'><span class='glyphicon glyphicon-remove red'><i class='fas fa-trash mr-1'></i></span></a></td></tr>"; // Binding the file name

                        $("#FilesList tbody").append(markup);
                    }
                chkatchtbl();
                $("#txtFileName").val('');
                $('#SOC_Files').val('');
                $('#btnupload').prop('disabled', false);
                return true;
            }
        });

        $("#btnupload").click(function () {
            formdata.append('uploadername', $('#txtuploader').val());
            formdata.append('FileNames', $('#txtFileName').val());
            $.ajax({
                url: '/EFile/UploadFiles',
                type: "POST",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: formdata,
                async: false,
                success: function (result) {
                    if (result != "") {
                        alert(result);
                    }
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        });
    });
    function DeleteFile(Fileid, FileName) {
        formdata.delete(FileName)
        $("#" + Fileid).remove();
        chkatchtbl();
    }
    function chkatchtbl() {
        if ($('#FilesList tr').length > 1) {
            $("#FilesList").css("visibility", "visible");
        } else {
            $("#FilesList").css("visibility", "hidden");
        }
    }
</script>
<script type="text/javascript">
    function EfileDetails() {
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/EFile/EfileDetails",
            data: '',
            success: function (data) {
                var row = "";
                var count = 1;
                $.each(data, function (index, item) {
                    if (count == 1) {
                        row += "<tr><th scope='row' >" + count + "</th><td style='display: none'>" + item.EfileRouteID + " <input class='id' type='hidden' value='" + item.EfileID + "'></td><td  style='display: none'>" + item.EfileID + "</td><td>" + item.UserName + " </td><td>" + item.Efile_sequence + "</td> <td class='text-left' <i class='fas fa-arrow-up text-white'></i> <strong><a href='/Efile/Index?EfileRouteID=" + item.EfileRouteID + "&Efile_sequence=" + item.Efile_sequence + "' onclick='DownRoutingMember(" + item.EfileRouteID + "," + item.EfileID + ", " + item.Efile_sequence + ");'></strong><i class='fas fa-arrow-down text-white ml-2'></i></a></td></tr>";
                    }
                    else if (count == 2) {
                        row += "<tr><th scope='row' >" + count + "</th><td style='display: none'>" + item.EfileRouteID + " <input class='id' type='hidden' value='" + item.EfileID + "'></td><td  style='display: none'>" + item.EfileID + "</td><td>" + item.UserName + " </td><td>" + item.Efile_sequence + "</td> <td class='text-left' <i class='fas fa-arrow-up text-white'></i> <strong><a href='/Efile/Index?EfileRouteID=" + item.EfileRouteID + "&Efile_sequence=" + item.Efile_sequence + "' onclick='UPRoutingMember(" + item.EfileRouteID + "," + item.EfileID + ", " + item.Efile_sequence + ");'></strong> <i class='fas fa-arrow-up text-white ml-2'></i></strong></a><a href='/Efile/Index?EfileRouteID=" + item.EfileRouteID + "&Efile_sequence=" + item.Efile_sequence + "' onclick='DownRoutingMember(" + item.EfileRouteID + "," + item.EfileID + ", " + item.Efile_sequence + ");'></strong><i class='fas fa-arrow-down text-white ml-2'></i></td></tr>";
                    }
                    else {
                        row += "<tr><th scope='row' >" + count + "</th><td style='display: none'>" + item.EfileRouteID + " <input class='id' type='hidden' value='" + item.EfileID + "'></td><td  style='display: none'>" + item.EfileID + "</td><td>" + item.UserName + " </td><td>" + item.Efile_sequence + "</td> <td class='text-left' <i class='fas fa-arrow-up text-white'></i> <strong><a href='/Efile/Index?EfileRouteID=" + item.EfileRouteID + "&Efile_sequence=" + item.Efile_sequence + "'  onclick='UPRoutingMember(" + item.EfileRouteID + "," + item.EfileID + ", " + item.Efile_sequence + ");'></strong><i class='fas fa-arrow-up text-white ml-2'></i></a></td></tr>";
                    }
                    count++;

                });
                $("#tblEfiles").html(row);
                if (count > 1) {
                    $('#div1').css("display", "block");
                    //$('#div1').show();
                }
            },
            error: function (result) {
                alert("Error");
            }
        })
    }
    function UPRoutingMember(EfileRouteID, EfileID, Efile_sequence) {
        //debugger;
        var Flag = 'UP';
        // alert(Flag);
        //////debugger;
        if (EfileID != '') {
            if (confirm("Do you want to routing this user? ")) {
                var data = { 'EfileRouteID': EfileRouteID, 'EfileID': EfileID, 'Efile_sequence': Efile_sequence, 'Flag': Flag }
                $.post('/Efile/RoutingMember', data,
                    function (data) {
                        if (data != '') {
                            alert(data);
                            EfileDetails();
                        }
                        else
                            alert("Could not routing this user");
                    });
            }
        }
    }
    function DownRoutingMember(EfileRouteID, EfileID, Efile_sequence) {
        // debugger;
        var Flag = 'DOWN';
        //  alert(Flag);
        //////debugger;
        if (EfileID != '') {
            if (confirm("Do you want to routing this user? ")) {
                var data = { 'EfileRouteID': EfileRouteID, 'EfileID': EfileID, 'Efile_sequence': Efile_sequence, 'Flag': Flag }
                $.post('/Efile/RoutingMember', data,
                    function (data) {
                        if (data != '') {
                            alert(data);
                            EfileDetails();
                        }
                        else
                            alert("Could not routing this user");
                    });
            }
        }
    }
    function ExistsEfileDetailsByUserID() {
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/EFile/ExistsEfileDetailsByUserID",
            data: '',
            success: function (data) {
                var count = 1;
                $.each(data, function (index, item) {
                    count++;
                    if (item.Efile_sequence == 1) {
                        $('#MAINDiv').css("display", "block");
                        $("#N2ContentType").hide();
                        $("#txtN1Editor").hide();
                        $("#N1ContentType").text("N1");
                        $('#dvUserdetailsN1').css("display", "none");
                        $('#dvUserdetailsN2').css("display", "none");
                        $("#N3ContentType").hide();

                        $("#btnN1Save").show();
                        $("#btnN2Save").hide();
                        $("#mainEditor").css("display", "block");
                        $("#mainfileupload").css("display", "block");

                        //$("#N1ContentType").text("N1");
                        //$('#txtEditor').summernote('code', item.EditorContent);
                        //$("#N2ContentType").hide();
                        //$("#N3ContentType").hide();
                        //$("#dvUserdetailsN1").css("display", "block");
                        //$('#txtN1Editor').summernote('code', item.EditorContent);
                        //$("#txtN1Editor").prop('disabled', true);
                        //$('#txtN1Editor').summernote('disable');
                        //$("#btnN1Save").hide();
                        //$("#hidEfileID").val(item.EfileID);
                        //ExistsEfileDetailsByN1();
                    }
                    else if (item.Efile_sequence == 2) {
                        $("#N1ContentType").text("N1");
                        $("#N2ContentType").text("N2");
                        $('#txtN1Editor').summernote('code', item.EditorContent);
                        $("#txtN1Editor").prop('disabled', true);
                        $('#txtN1Editor').summernote('disable');
                        $('#dvUserdetailsN1').css("display", "block");
                        $("#N3ContentType").hide();
                        $("#hidEfileID").val(item.EfileID);
                        $("#mainEditor").css("display", "block");
                        $("#mainfileupload").css("display", "block");
                        $("#btnN2Save").show();
                        $("#btnN1Save").hide();
                        $("#btnN3Save").hide();
                        ExistsEfileDetailsByN1();
                        EfileDetails();
                    }
                    else if (item.Efile_sequence == 3) {
                        $("#N1ContentType").text("N1");
                        $("#N2ContentType").text("N2");
                        $('#txtN1Editor').summernote('code', item.EditorContent);
                        $("#txtN1Editor").prop('disabled', true);
                        $('#txtN1Editor').summernote('disable');
                        $('#txtN2Editor').summernote('code', item.EditorContent);
                        $("#txtN2Editor").prop('disabled', true);
                        //$('#dvUserdetailsN1').css("display", "block");
                        //$('#dvUserdetailsN2').css("display", "block");
                        $('#txtEditor').summernote('code', item.EditorContent);
                        $("#N3ContentType").text("N3")
                        $("#hidEfileID").val(item.EfileID);
                        $("#mainEditor").css("display", "block");
                        $("#mainfileupload").css("display", "block");
                        $("#btnN1Save").hide();
                        $("#btnN2Save").hide();
                        $("#btnN3Save").show();
                        ExistsEfileDetailsByN1();
                        ExistsEfileDetailsByN2();
                        EfileDetails();
                    }
                });

                if (count <= 1) {
                    $('#MAINDiv').css("display", "block");
                    $("#N2ContentType").hide();
                    $("#txtN1Editor").hide();
                    $("#N1ContentType").text("N1");
                    $('#dvUserdetailsN1').css("display", "none");
                    $('#dvUserdetailsN2').css("display", "none");
                    $("#N3ContentType").hide();

                    $("#btnN1Save").show();
                    $("#btnN2Save").hide();
                    $("#mainEditor").css("display", "block");
                    $("#mainfileupload").css("display", "block");
                }
            },
            error: function (result) {
                alert("Error");
            }
        })
    }
    function ExistsEfileDetailsByN1() {
        var SequenceID = ''
        if ($("#N1ContentType").text("N1")) {
            SequenceID = '1';
        }
        var dataObject = {
            Efile_sequence: SequenceID
        };
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "/EFile/ExistsEfileDetailsBySquence",
            //data: dataObject,
            data: "{'_model':" + JSON.stringify(dataObject) + " }",
            success: function (data) {
                var count = 1;
                $.each(data, function (index, item) {
                    count++;
                    $('#dvUserdetailsN1').css("display", "block");
                    $("#N1ContentType").text("N1");
                    $("#N1Name").text(item.UserName);
                    $("#N1Designation").text(item.Designation);
                    $("#N1EfileDate").text(item.EfileDate);

                });
                if (count == 1) {
                    $('#dvUserdetailsN1').css("display", "none");
                }
            },
            error: function (result) {
                alert("Error");
            }
        })
    }
    function ExistsEfileDetailsByN2() {
        var SequenceID = ''
        if ($("#N2ContentType").text("N2")) {
            SequenceID = '2';
        }
        var dataObject = {
            Efile_sequence: SequenceID
        };
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "/EFile/ExistsEfileDetailsBySquence",
            //data: dataObject,
            data: "{'_model':" + JSON.stringify(dataObject) + " }",
            success: function (data) {
                var count = 1;
                $.each(data, function (index, item) {
                    count++;
                    $("#N2ContentType").text("N2");
                    $("#N2Name").text(item.UserName);
                    $("#N2Designation").text(item.Designation);
                    $("#N2EfileDate").text(item.EfileDate);
                    $("#txtN2Editor").text(item.EditorContent);
                    $('#dvUserdetailsN2').css("display", "block");
                });
                if (count <= 1) {
                    $('#dvUserdetailsN2').css("display", "none");
                    $("#N2ContentType").hide();
                }
            },
            error: function (result) {
                alert("Error");
            }
        })
    }
    function N1ShowAttachmentFile() {
        var EfileID = ''
        EfileID = $("#hidEfileID").val();
        var dataObject = {
            EfileID: EfileID
        };
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "/EFile/EfileshowAttachment",
            data: "{'_model':" + JSON.stringify(dataObject) + " }",
            success: function (data) {
                var row = "";
                var count = 1;
                $.each(data, function (index, item) {
                    row += "<tr><th scope='row' >" + count + "</th><td style='display: none'>" + item.Filepath + " <input class='id' type='hidden' value='" + item.NoteFileId + "'></td><td  style='display: none'>" + item.Filepath + "</td><td>" + item.Filenames + " </td> <td class='text-left' <i class='fas fa-arrow-up text-white'></i> <strong><a href='" + item.Filepath + "' target='_blank' ></strong><i class='fas fa-eye text-white float-right mr-6'></i></a></td></tr>";
                    count++;
                });
                $("#tblEfileAttcahmentfiles").html(row);
                if (count > 1)
                    $('#dvAttachmentfileN1').css("display", "block");
            },
            error: function (result) {
                alert("Error");
            }
        })
    }
    function N2ShowAttachmentFile() {
        var EfileID = ''
        EfileID = $("#hidEfileID").val();
        var dataObject = {
            EfileID: EfileID
        };
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "/EFile/EfileshowAttachment",
            data: "{'_model':" + JSON.stringify(dataObject) + " }",
            success: function (data) {
                var row = "";
                var count = 1;
                $.each(data, function (index, item) {
                    row += "<tr><th scope='row' >" + count + "</th><td style='display: none'>" + item.Filepath + " <input class='id' type='hidden' value='" + item.NoteFileId + "'></td><td  style='display: none'>" + item.Filepath + "</td><td>" + item.Filenames + " </td> <td class='text-left' <i class='fas fa-arrow-up text-white'></i><strong><a href='" + item.Filepath + "' target='_blank' ></strong><i class='fas fa-eye text-white float-right mr-6'></i></a></td></tr>";
                    count++;
                });
                $("#tblEfileAttcahmentfilesN2").html(row);
                if (count > 1)
                    $('#dvAttachmentfileN2').css("display", "block");
            },
            error: function (result) {
                alert("Error");
            }
        })
    }
    function downloadFile(FileName) {
        alert(FileName);
        var dataObject = {
            Filenames: FileName
        };
        if (confirm("Do you want to download file? ")) {
           $.ajax({
                url: '@Url.Action("DownloadAttachment", "EFile")',
               data: "{'_model':" + JSON.stringify(dataObject) + " }",
                contentType: 'application/json; charset=utf-8',
                datatype: 'json',
                type: "POST",
               success: function () {
                   
                }
            });    
        }
    }
    function DeleteFile() {
        if (confirm("Do you want to delete file? ")) {

        }
    }
    $(".ViewSOCFilePrev").click(function () {
        $("#divViewSOCPrev").toggle("slow");
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "/EFile/EfileDetails",
            data: '',
            success: function (data) {
                var row = "";
                var count = 1;
                $.each(data, function (index, item) {

                    row += "<tr><th scope='row' >" + count + "</th><td style='display: none'>" + item.EfileRouteID + " <input class='id' type='hidden' value='" + item.EfileID + "'></td><td  style='display: none'>" + item.EfileID + "</td><td>" + item.UserName + " </td><td>" + item.Designation + "</td><td>" + item.Subjects + "</td><td>" + item.ReferenceNo + "</td> </tr>";
                    count++;

                });
                $("#tblESOCPreviousFiles").html(row);
                if (count > 1) {
                    $('#divViewSOCPrev').css("display", "block");
                }
            },
            error: function (result) {
                alert("Error");
            }
        })
    });
   
</script>
<script type="text/javascript">
    function OnError(xhr, errorType, exception) {
        var responseText;
        $("#dialog").html("");
        try {
            responseText = jQuery.parseJSON(xhr.responseText);
            $("#dialog").append("<div><b>" + errorType + " " + exception + "</b></div>");
            $("#dialog").append("<div><u>Exception</u>:<br /><br />" + responseText.ExceptionType + "</div>");
            $("#dialog").append("<div><u>StackTrace</u>:<br /><br />" + responseText.StackTrace + "</div>");
            $("#dialog").append("<div><u>Message</u>:<br /><br />" + responseText.Message + "</div>");
        } catch (e) {
            responseText = xhr.responseText;
            $("#dialog").html(responseText);
        }
        $("#dialog").dialog({
            title: "jQuery Exception Details",
            width: 700,
            buttons: {
                Close: function () {
                    $(this).dialog('close');
                }
            }
        });
    }
</script>
@*}*@